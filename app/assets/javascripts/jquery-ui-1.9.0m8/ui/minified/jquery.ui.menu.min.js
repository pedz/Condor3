/*! jQuery UI - v1.9.0m8 - 2012-05-17
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.menu.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a){var b=0,c=null;a.widget("ui.menu",{version:"1.9.0m8",defaultElement:"<ul>",delay:300,options:{menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.menuId=this.element.attr("id")||"ui-menu-"+b++,this.element.find(".ui-icon").length&&this.element.addClass("ui-menu-icons"),this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({id:this.menuId,role:this.options.role,tabIndex:0}).bind("click.menu",a.proxy(function(a){this.options.disabled&&a.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._bind({"mousedown .ui-menu-item > a":function(a){a.preventDefault()},"click .ui-state-disabled > a":function(a){a.preventDefault()},"click .ui-menu-item:has(a)":function(b){var d=a(b.target);d[0]!==c&&(c=d[0],d.one("click.menu",function(a){c=null}),d.closest(".ui-menu-item").is(".ui-state-disabled")||(this.select(b),this._delay(function(){this.element.is(":focus")||this.element.focus()},20)))},"mouseenter .ui-menu-item":function(b){var c=a(b.currentTarget);c.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(b,c)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(b){var c=this.element,d=c.children(".ui-menu-item").eq(0);this._hasScroll()&&!this.active?c.children().each(function(){var b=a(this);if(b.offset().top-c.offset().top>=0)return d=b,!1}):this.active&&(d=this.active),this.focus(b,d)},blur:function(b){this._delay(function(){a.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(b)})},keydown:"_keydown"}),this.refresh(),this._bind(this.document,{click:function(b){a(b.target).closest(".ui-menu").length||this.collapseAll(b)}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").show(),this.element.find(".ui-menu-item").unbind(".menu").removeClass("ui-menu-item").removeAttr("role").children("a").removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").removeAttr("id").children(".ui-icon").remove(),a(c).unbind("click.menu")},_keydown:function(b){switch(b.keyCode){case a.ui.keyCode.PAGE_UP:this.previousPage(b),b.preventDefault();break;case a.ui.keyCode.PAGE_DOWN:this.nextPage(b),b.preventDefault();break;case a.ui.keyCode.HOME:this._move("first","first",b),b.preventDefault();break;case a.ui.keyCode.END:this._move("last","last",b),b.preventDefault();break;case a.ui.keyCode.UP:this.previous(b),b.preventDefault();break;case a.ui.keyCode.DOWN:this.next(b),b.preventDefault();break;case a.ui.keyCode.LEFT:this.collapse(b),b.preventDefault();break;case a.ui.keyCode.RIGHT:this.active.is(".ui-state-disabled")||this.expand(b),b.preventDefault();break;case a.ui.keyCode.ENTER:this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(b):this.select(b)),b.preventDefault();break;case a.ui.keyCode.ESCAPE:this.collapse(b),b.preventDefault();break;default:clearTimeout(this.filterTimer);var c,d=this.previousFilter||"",e=String.fromCharCode(b.keyCode),f=!1;e===d?f=!0:e=d+e;function g(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}c=this.activeMenu.children(".ui-menu-item").filter(function(){return(new RegExp("^"+g(e),"i")).test(a(this).children("a").text())}),c=f&&c.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):c,c.length||(e=String.fromCharCode(b.keyCode),c=this.activeMenu.children(".ui-menu-item").filter(function(){return(new RegExp("^"+g(e),"i")).test(a(this).children("a").text())})),c.length?(this.focus(b,c),c.length>1?(this.previousFilter=e,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}},refresh:function(){var b,c=this.menuId,d=this.element.find(this.options.menus+":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"});b=d.add(this.element),b.children(":not( .ui-menu-item ):has( a )").addClass("ui-menu-item").attr("role","presentation").children("a").addClass("ui-corner-all").attr("tabIndex",-1).attr("role",this._itemRole()).attr("id",function(a){return c+"-"+a}),b.children(":not(.ui-menu-item)").addClass("ui-widget-content ui-menu-divider"),b.children(".ui-state-disabled").attr("aria-disabled","true"),d.each(function(){var b=a(this),c=b.prev("a");c.attr("aria-haspopup","true").prepend('<span class="ui-menu-icon ui-icon ui-icon-carat-1-e"></span>'),b.attr("aria-labelledby",c.attr("id"))})},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(b,c){var d,e,f,g,h,i,j,k;this.blur(b,b&&b.type==="focus"),this._hasScroll()&&(e=parseFloat(a.css(this.activeMenu[0],"borderTopWidth"))||0,f=parseFloat(a.css(this.activeMenu[0],"paddingTop"))||0,g=c.offset().top-this.activeMenu.offset().top-e-f,h=this.activeMenu.scrollTop(),i=this.activeMenu.height(),j=c.height(),g<0?this.activeMenu.scrollTop(h+g):g+j>i&&this.activeMenu.scrollTop(h+g-i+j)),this.active=c.first(),k=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",k.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),b.type==="keydown"?this._close():this.timer=this._delay(function(){this._close()},this.delay),d=a("> .ui-menu",c),d.length&&/^mouse/.test(b.type)&&this._startOpening(d),this.activeMenu=c.parent(),this._trigger("focus",b,{item:c})},blur:function(a,b){b||clearTimeout(this.timer);if(!this.active)return;this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",a,{item:this.active})},_startOpening:function(a){clearTimeout(this.timer);if(a.attr("aria-hidden")!=="true")return;this.timer=this._delay(function(){this._close(),this._open(a)},this.delay)},_open:function(b){clearTimeout(this.timer),this.element.find(".ui-menu").not(b.parents()).hide().attr("aria-hidden","true");var c=a.extend({},{of:this.active},a.type(this.options.position)==="function"?this.options.position(this.active):this.options.position);b.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(c)},collapseAll:function(b,c){clearTimeout(this.timer),this.timer=this._delay(function(){var d=c?this.element:a(b&&b.target).closest(this.element.find(".ui-menu"));d.length||(d=this.element),this._close(d),this.blur(b),this.activeMenu=d},this.delay)},_close:function(a){a||(a=this.active?this.active.parent():this.element),a.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(a){var b=this.active&&this.active.parent().closest(".ui-menu-item",this.element);if(b&&b.length)return this._close(),this.focus(a,b),!0},expand:function(a){var b=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();if(b&&b.length)return this._open(b.parent()),this._delay(function(){this.focus(a,b)},20),!0},next:function(a){this._move("next","first",a)},previous:function(a){this._move("prev","last",a)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(a,b,c){var d;this.active&&(a==="first"||a==="last"?d=this.active[a==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1):d=this.active[a+"All"](".ui-menu-item").eq(0));if(!d||!d.length||!this.active)d=this.activeMenu.children(".ui-menu-item")[b]();this.focus(c,d)},nextPage:function(b){if(!this.active){this._move("next","first",b);return}if(this.isLastItem())return;if(this._hasScroll()){var c=this.active.offset().top,d=this.element.height(),e;this.active.nextAll(".ui-menu-item").each(function(){return e=a(this),a(this).offset().top-c-d<0}),this.focus(b,e)}else this.focus(b,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())},previousPage:function(b){if(!this.active){this._move("next","first",b);return}if(this.isFirstItem())return;if(this._hasScroll()){var c=this.active.offset().top,d=this.element.height(),e;this.active.prevAll(".ui-menu-item").each(function(){return e=a(this),a(this).offset().top-c+d>0}),this.focus(b,e)}else this.focus(b,this.activeMenu.children(".ui-menu-item").first())},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(a){var b={item:this.active};this.collapseAll(a,!0),this._trigger("select",a,b)}})})(jQuery);